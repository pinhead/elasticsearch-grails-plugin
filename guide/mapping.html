<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>3 Mapping 0.0.3.2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/configuration.html"><strong>2</strong><span>Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/mapping.html"><strong>3</strong><span>Mapping</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/indexing.html"><strong>4</strong><span>Indexing</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/searching.html"><strong>5</strong><span>Searching</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/admin.html"><strong>6</strong><span>Admin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/lowLevelAPI.html"><strong>7</strong><span>Low level API</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/example.html"><strong>8</strong><span>Example</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>The revived Elasticsearch plugin for Grails.</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/configuration.html">&lt;&lt; <strong>2</strong><span>Configuration</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/indexing.html"><strong>4</strong><span>Indexing</span> >></a></div>
                


                <div class="project">
                    <h1>3 Mapping - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Noam Y. Tenne, Manuarii Stein, Stephane Maldini, Serge P. Nekoval</p>

                    <p><strong>Version:</strong> 0.0.3.2</p>

                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#quickStart"><strong>3.1</strong><span>QuickStart</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#classMapping"><strong>3.2</strong><span>Class Mapping</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#propertiesMapping"><strong>3.3</strong><span>Properties mapping</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#parentChild"><strong>3.3.1</strong><span>Parent-Child</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#geoPoint"><strong>3.3.2</strong><span>GeoPoint</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#alias"><strong>3.3.3</strong><span>Alias</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#searchableComponentReference"><strong>3.4</strong><span>Searchable Component-Reference</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#searchableReference"><strong>3.4.1</strong><span>Searchable Reference</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#searchableComponent"><strong>3.4.2</strong><span>Searchable Component</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="mapping">3 Mapping</h1>




<h2 id="quickStart">3.1 QuickStart</h2>
<h4>Default mapping</h4>
To declare a domain class to be searchable, the simplest way is to define the following static property in the code:
<div class="code"><pre><span class="java&#45;keyword">static</span> searchable = <span class="java&#45;keyword">true</span></pre></div>
The plugin will generate a default mapping for each properties of the domain.<p class="paragraph"/><h4>Custom mapping</h4>
You can customize how each properties are mapped to the index using a closure. The syntax is similar to GORM's mapping DSL.
<div class="code"><pre><span class="java&#45;keyword">static</span> searchable = &#123;
    // mapping DSL&#8230;
&#125;</pre></div>
See below for more details on the mapping DSL.<p class="paragraph"/><h4>Limit properties with only/except</h4>
<code>only</code> and <code>except</code> are used to limit the properties that are made searchable.
You may not define both except &#38; only settings at the same time.<p class="paragraph"/>The following code will only map the 'message' property, any others will be ignored.
<div class="code"><pre>class Tweet &#123;
    <span class="java&#45;keyword">static</span> searchable = &#123;
        only = 'message'
    &#125;
    <span class="java&#45;object">String</span> message
    <span class="java&#45;object">String</span> someUselessField
&#125;</pre></div><p class="paragraph"/>The following code will map all properties except the one specified.
<div class="code"><pre>class Tweet &#123;
    <span class="java&#45;keyword">static</span> searchable = &#123;
        except = 'someUselessField'
    &#125;
    <span class="java&#45;object">String</span> message
    <span class="java&#45;object">String</span> someUselessField
&#125;</pre></div><p class="paragraph"/>You can use a Collection to specify several properties.
<div class="code"><pre>class Tweet &#123;
    <span class="java&#45;keyword">static</span> searchable = &#123;
        except = &#91;'someUselessField', 'userName'&#93;
    &#125;
    <span class="java&#45;object">String</span> message
    <span class="java&#45;object">String</span> userName
    <span class="java&#45;object">String</span> someUselessField
&#125;</pre></div><p class="paragraph"/><blockquote class="note">The properties that are ignored will not be sent to ElasticSearch. It also means that when you will get back a domain
from ElasticSearch, some fields that are not supposed to be null, may still be null.</blockquote>



<h2 id="classMapping">3.2 Class Mapping</h2>
<h4>root</h4>
Determine if the domain class will have its own index or not. Take a boolean as parameter, and is set to <code>true</code> by default.
<div class="code"><pre>class Preference &#123;
    <span class="java&#45;keyword">static</span> searchable = &#123;
        root <span class="java&#45;keyword">false</span>
    &#125;
    // &#8230;
&#125;<p class="paragraph"/>class Tag &#123;
    <span class="java&#45;keyword">static</span> searchable = <span class="java&#45;keyword">true</span>
    // &#8230;
&#125;<p class="paragraph"/>class Tweet &#123;
    <span class="java&#45;keyword">static</span> searchable = &#123;
        message boost:2.0
    &#125;
    // &#8230;
&#125;</pre></div>
In this code, the classes <code>Tweet</code> and <code>Tag</code> are going to have their own index. The class <code>Preference</code> will not.
It also mean that any search request will never return a Preference-type hit. The dynamic method <code>search</code> will not be
injected in the <code>Preference</code> domain class.
The domains not root-mapped can still be considered searchable, as they can be components of another domain which is root-mapped.
For example, considered the following domain:
<div class="code"><pre>class User &#123;
    <span class="java&#45;keyword">static</span> searchable = &#123;
        userPreferences component:<span class="java&#45;keyword">true</span>
    &#125;<p class="paragraph"/>    Preference userPreferences
&#125;</pre></div>
When searching, any matches in the <code>userPreferences</code> property will be considered as a <code>User</code> match.



<h2 id="propertiesMapping">3.3 Properties mapping</h2>
You can customize the mapping for each domain properties using the closure mapping.
The syntax is simple:
<div class="code"><pre><span class="java&#45;keyword">static</span> searchable = &#123;
    propertyName option1:value, option2:value, &#8230;
&#125;</pre></div><p class="paragraph"/><h4>Available options</h4><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Option name</strong></th><th>Values</th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td>boost</td><td>Number</td><td>A decimal boost value. With a positive value, promotes search results for hits in this property; with a negative value, demotes search results that hit this property.</td></tr><tr class="table-even"><td><a href="../guide/single.html#searchableComponent" class="guide">component</a></td><td><code>true</code>, <code>false</code></td><td>To use only on domain (or collection of domains), make the property a searchable component.</td></tr><tr class="table-odd"><td>converter</td><td>A <code>Class</code></td><td>A <code>Class</code> to use as a converter during the marshalling/unmarshalling process for that peculiar property. That class must extends the <code>PropertyEditorSupport</code> java class.</td></tr><tr class="table-even"><td>excludeFromAll</td><td><code>true</code>, <code>false</code></td><td>determines if the property is to append in the <code>"_all"</code> field. Default to <code>true</code>.</td></tr><tr class="table-odd"><td>index</td><td><code>"no"</code>, <code>"not_analyzed"</code>, <code>"analyzed"</code>.</td><td>How or if the property is made into searchable element. One of <code>"no"</code>, <code>"not_analyzed"</code> or <code>"analyzed"</code>.</td></tr><tr class="table-even"><td><a href="../guide/single.html#searchableReference" class="guide">reference</a></td><td><code>true</code>, <code>false</code></td><td>To use only on domain (or collection of domains), make the property a searchable reference.</td></tr><tr class="table-odd"><td><a href="../guide/single.html#parentChild" class="guide">parent</a></td><td><code>true</code>, <code>false</code></td><td>A boolean value to be used in conjunction with the <code>reference</code> or <code>component</code> property . Set to <code>true</code> if the referenced field should be mapped as the parent of this document. Default set to <code>false</code>.</td></tr><tr class="table-even"><td>multi_field</td><td><code>true</code>, <code>false</code></td><td>A boolean value. Maps the value of the field twice; Once with it being analyzed, and once with it being not_analyzed under untouched. Default set to <code>false</code>.</td></tr><tr class="table-odd"><td><a href="../guide/single.html#geoPoint" class="guide">geoPoint</a></td><td><code>true</code>, <code>false</code></td><td>Maps the field to a geo_point. Default: <code>false</code></td></tr><tr class="table-even"><td><a href="../guide/single.html#alias" class="guide">alias</a></td><td>String</td><td>A string value.  The field noted with this parameter will be duplicated to an alias.</td></tr></table>



<h2 id="parentChild">3.3.1 Parent-Child</h2>
To map a parent/child relationship, the child element must either contain the parent element as a component or reference it as a referenced document.
This component must be mapped as a parent in the child element.<p class="paragraph"/><h4>Example</h4><p class="paragraph"/><div class="code"><pre>class ParentElement &#123;
…
&#125;<p class="paragraph"/>class EmbeddingChild &#123;
    ParentElement parentElement<p class="paragraph"/>    <span class="java&#45;keyword">static</span> searchable = &#123;
        parentElement parent: <span class="java&#45;keyword">true</span>, component: <span class="java&#45;keyword">true</span>
    &#125;
&#125;<p class="paragraph"/>class ReferencingChild &#123;
    ParentElement parentElement<p class="paragraph"/>    <span class="java&#45;keyword">static</span> searchable = &#123;
        parentElement parent: <span class="java&#45;keyword">true</span>, reference: <span class="java&#45;keyword">true</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>


<h2 id="geoPoint">3.3.2 GeoPoint</h2>
A geographic location can be mapped to a geo_point. The field for the longitude has to be named <code>lon</code> and the field for the latitude has to be named <code>lat</code><p class="paragraph"/><h4>Example</h4><p class="paragraph"/><div class="code"><pre>class GeoPoint &#123;<p class="paragraph"/>    <span class="java&#45;object">Double</span> lat
    <span class="java&#45;object">Double</span> lon<p class="paragraph"/>    <span class="java&#45;keyword">static</span> searchable = &#123;
        root <span class="java&#45;keyword">false</span>
    &#125;
&#125;<p class="paragraph"/>class Building &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> name
    GeoPoint location<p class="paragraph"/>    <span class="java&#45;keyword">static</span> searchable = &#123;
        location geoPoint: <span class="java&#45;keyword">true</span>, component: <span class="java&#45;keyword">true</span>
    &#125;
&#125;</pre></div>



<h2 id="alias">3.3.3 Alias</h2>
A field can be aliased.  This is useful in situations where another service may expect certain tags.
For example, <a href="http://www.elasticsearch.org/overview/kibana/" target="blank">Kibana</a> uses an <code>&#64;timestamp</code> field to filter
report records by date.<p class="paragraph"/><h4>Example</h4><p class="paragraph"/><div class="code"><pre>class Session &#123;<p class="paragraph"/>    Date loginTime<p class="paragraph"/>    <span class="java&#45;keyword">static</span> searchable = &#123;
        loginTime alias:'@timestamp'
    &#125;
&#125;</pre></div>



<h2 id="searchableComponentReference">3.4 Searchable Component-Reference</h2>
The plugin support a similar searchable-component &#38; searchable-reference behavior from Compass
when you are dealing with domain association.
See below to find out about the difference between both mapping modes.



<h2 id="searchableReference">3.4.1 Searchable Reference</h2>
The searchable-reference mapping mode is the default mode used for association, and requires the
searchable class of the association to be root-mapped in order to have its own index.
With this mode, the associated domains are not completely marshalled in the resulting JSON document:
only the id and the type of the instances are kept.
When the document is retrieved from the index, the plugin will automatically rebuild the association from the
indices using the stored id.<p class="paragraph"/><strong class="bold">Example</strong>
<div class="code"><pre>class MyDomain &#123;
    // odom is an association with the OtherDomain class, set as a reference
    OtherDomain odom<p class="paragraph"/>    <span class="java&#45;keyword">static</span> searchable = &#123;
        odom reference:<span class="java&#45;keyword">true</span>
    &#125;
&#125;<p class="paragraph"/>// The OtherDomain definition, with <span class="java&#45;keyword">default</span> searchable configuration
class OtherDomain &#123;
    <span class="java&#45;keyword">static</span> searchable = <span class="java&#45;keyword">true</span><p class="paragraph"/>    <span class="java&#45;object">String</span> field1 = <span class="java&#45;quote">"val1"</span>
    <span class="java&#45;object">String</span> field2 = <span class="java&#45;quote">"val2"</span>
    <span class="java&#45;object">String</span> field3 = <span class="java&#45;quote">"val3"</span>
    <span class="java&#45;object">String</span> field4 = <span class="java&#45;quote">"val4"</span>
&#125;</pre></div><p class="paragraph"/>When indexing an instance of MyDomain, the resulting JSON documents will be sent to ElasticSearch:
<div class="code"><pre>&#123;
    <span class="java&#45;quote">"mydomain"</span>: &#123;
        <span class="java&#45;quote">"_id"</span>:1,
        <span class="java&#45;quote">"odom"</span>: &#123; <span class="java&#45;quote">"id"</span>:1 &#125;
    &#125;
&#125;<p class="paragraph"/>&#123;
    <span class="java&#45;quote">"otherdomain"</span>: &#123;
        <span class="java&#45;quote">"_id"</span>:1,
        <span class="java&#45;quote">"field1"</span>:<span class="java&#45;quote">"val1"</span>,
        <span class="java&#45;quote">"field2"</span>:<span class="java&#45;quote">"val2"</span>,
        <span class="java&#45;quote">"field3"</span>:<span class="java&#45;quote">"val3"</span>,
        <span class="java&#45;quote">"field4"</span>:<span class="java&#45;quote">"val4"</span>
    &#125;
&#125;</pre></div>



<h2 id="searchableComponent">3.4.2 Searchable Component</h2>
The searchable-component mapping mode must be explicitly set, and does not require the
searchable class of the association to be root-mapped.
With this mode, the associated domains are nested in the parent document.<p class="paragraph"/><strong class="bold">Example</strong>
<div class="code"><pre>class MyDomain &#123;
    // odom is an association with the OtherDomain class, set as a reference
    OtherDomain odom<p class="paragraph"/>    <span class="java&#45;keyword">static</span> searchable = &#123;
        odom component:<span class="java&#45;keyword">true</span>
    &#125;
&#125;<p class="paragraph"/>// The OtherDomain definition, with <span class="java&#45;keyword">default</span> searchable configuration
class OtherDomain &#123;
    <span class="java&#45;keyword">static</span> searchable = <span class="java&#45;keyword">true</span><p class="paragraph"/>    <span class="java&#45;object">String</span> field1 = <span class="java&#45;quote">"val1"</span>
    <span class="java&#45;object">String</span> field2 = <span class="java&#45;quote">"val2"</span>
    <span class="java&#45;object">String</span> field3 = <span class="java&#45;quote">"val3"</span>
    <span class="java&#45;object">String</span> field4 = <span class="java&#45;quote">"val4"</span>
&#125;</pre></div><p class="paragraph"/>When indexing an instance of MyDomain, the resulting JSON document will be sent to ElasticSearch:
<div class="code"><pre>&#123;
    <span class="java&#45;quote">"mydomain"</span>: &#123;
        <span class="java&#45;quote">"_id"</span>:1,
        <span class="java&#45;quote">"odom"</span>: &#123;
            <span class="java&#45;quote">"_id"</span>:1,
            <span class="java&#45;quote">"field1"</span>:<span class="java&#45;quote">"val1"</span>,
            <span class="java&#45;quote">"field2"</span>:<span class="java&#45;quote">"val2"</span>,
            <span class="java&#45;quote">"field3"</span>:<span class="java&#45;quote">"val3"</span>,
            <span class="java&#45;quote">"field4"</span>:<span class="java&#45;quote">"val4"</span>
        &#125;
    &#125;
&#125;</pre></div>



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/configuration.html">&lt;&lt; <strong>2</strong><span>Configuration</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/indexing.html"><strong>4</strong><span>Indexing</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Dynamic Domain Methods</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Dynamic%20Domain%20Methods/countHits.html">countHits</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Dynamic%20Domain%20Methods/index.html">index</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Dynamic%20Domain%20Methods/search.html">search</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Dynamic%20Domain%20Methods/unindex.html">unindex</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">ElasticSearchAdminService</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/ElasticSearchAdminService/deleteIndex.html">deleteIndex</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/ElasticSearchAdminService/refresh.html">refresh</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">ElasticSearchService</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/ElasticSearchService/countHits.html">countHits</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/ElasticSearchService/index.html">index</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/ElasticSearchService/search.html">search</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/ElasticSearchService/unindex.html">unindex</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
